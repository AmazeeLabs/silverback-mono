---
title: PHPStan for Drupal modules
path: /tooling/phpstan/for-drupal-modules
nav: Tooling
position: 4
---

# PHPStan for Drupal modules

[PHPStan](https://phpstan.org/) is a static analysis tool for PHP code.

Main features:
- It forces you to add type annotations for everything.
- It checks if correct types are passed around.
- It supports generics!
- It has a number of plugins extending its functionality.

## Adding PHPStan checks to a Drupal module

1. Require [mglaman/phpstan-drupal](https://github.com/mglaman/phpstan-drupal) and [phpstan/extension-installer](https://github.com/phpstan/extension-installer) in the dev dependencies of the module's `composer.json`. Example:
  ```json
    "require-dev": {
      "mglaman/phpstan-drupal": "^0.12.5",
      "phpstan/extension-installer": "^1.0"
    }
  ```
1. Create `phpstan.neon` file in the module root. Example:
  ```yaml
  parameters:
      level: 8
      checkGenericClassInNonGenericObjectType: false
      checkMissingIterableValueType: false
      paths:
          - my_module.module
          - my_module.install
          - src
          - tests
  ```
  See [PHPStan docs](https://phpstan.org/config-reference) for all available options.
1. Run the checks from the Drupal root:
  ```
  vendor/bin/phpstan analyse --configuration=web/modules/custom/my_module/phpstan.neon
  ```

## Additional plugins

Some popular plugins for PHPStan:
- [phpstan/phpstan-deprecation-rules](https://github.com/phpstan/phpstan-deprecation-rules) reports usages of deprecated code (consider it only if you run PHPStan from the oldest supported version of Drupal)
- [phpstan/phpstan-strict-rules](https://github.com/phpstan/phpstan-strict-rules) provides very strict (and even draconic) rules

See other plugins at https://phpstan.org/user-guide/extension-library

## IDE support

PhpStorm will have a [built-in support for PHPStan soon](https://blog.jetbrains.com/phpstorm/2020/07/phpstan-and-psalm-support-coming-to-phpstorm/), [maybe in PhpStorm 2020.3](https://youtrack.jetbrains.com/issue/WI-35063). The community [plugin](https://plugins.jetbrains.com/plugin/12754-phpstan--psalm--generics) is unfortunately [broken](https://github.com/Haehnchen/idea-php-generics-plugin/issues/56) at the moment.
