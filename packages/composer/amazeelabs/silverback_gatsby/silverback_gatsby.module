<?php

use Drupal\Core\Access\AccessResult;
use Drupal\Core\Entity\EntityInterface;
use Drupal\Core\Session\AccountInterface;
use Drupal\silverback_gatsby\Plugin\Gatsby\Feed\EntityFeed;
use Drupal\system\MenuInterface;


function _silverback_gatsby_entity_event(EntityInterface $entity) {
  \Drupal::service('silverback_gatsby.update_handler')->handle(EntityFeed::class, $entity);
}

/**
 * Implements hook_entity_create().
 */
function silverback_gatsby_entity_insert(EntityInterface $entity) {
  _silverback_gatsby_entity_event($entity);
}

/**
 * Implements hook_entity_update().
 */
function silverback_gatsby_entity_update(EntityInterface $entity) {
  $controlHandler = \Drupal::entityTypeManager()->getAccessControlHandler($entity->getEntityTypeId());
  _silverback_gatsby_entity_event($entity->original);
  $controlHandler->resetCache();
  _silverback_gatsby_entity_event($entity);
}

/**
 * Implements hook_entity_delete().
 */
function silverback_gatsby_entity_delete(EntityInterface $entity) {
  _silverback_gatsby_entity_event($entity);
}

/**
 * Implements hook_ENTITY_TYPE_access().
 */
//function silverback_gatsby_menu_access(MenuInterface $entity, $operation, AccountInterface $account) {
//  return AccessResult::allowed();
//}
